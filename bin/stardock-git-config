#!/usr/bin/env stardock-launcher
# vim:ft=sh
### Usage:
###    stardock-git-config [<user>]
### --help
###
### Generate git configuration to override ssh.

USER="${user:-${USER:-root}}"

cat << EOF
StrictHostKeyChecking no
CheckHostIP no
LogLevel quiet
UserKnownHostsFile /dev/null
EOF

if [ -d "${PRIVATE_KEYS}" ]; then
  for key in $(find "${PRIVATE_KEYS}"); do
    if [ -f "${key}" ]; then
      get_HASH "${key}${USER}"
      if grep "PRIVATE KEY" "${key}" > /dev/null; then
        if [ ! -f /var/tmp/${HASH} ]; then
          cp "${key}" /var/tmp/${HASH}
          chown ${USER}:${USER} /var/tmp/${HASH}
          chmod 0400 /var/tmp/${HASH}
        fi
        echo "IdentityFile /var/tmp/${HASH}"
      fi
    fi
  done
fi
